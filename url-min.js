/*!
 * URL.js
 * 
 * Copyright 2011 Eric Ferraiuolo
 * https://github.com/ericf/urljs
 */
var URL=function(){var a=this;if(!(a&&a.hasOwnProperty&&(a instanceof URL))){a=new URL();}return a._init.apply(a,arguments);};(function(){var G="absolute",F="relative",c="http",C="https",h=":",u="//",g="@",w=".",f="/",B="..",r="../",d="?",p="=",m="&",i="#",b="",q="type",a="scheme",s="userInfo",D="host",x="port",E="path",A="query",v="fragment",z=/^(?:(https?:\/\/|\/\/)|(\/|\?|#)|[^;:@=\.\s])/i,t=/^(?:(https?):\/\/|\/\/)(?:([^:@\s]+:?[^:@\s]+?)@)?((?:[^;:@=\/\?\.\s]+\.)+[A-Za-z0-9\-]{2,})(?::(\d+))?(?=\/|\?|#|$)([^\?#]+)?(?:\?([^#]+))?(?:#(.+))?/i,k=/^([^\?#]+)?(?:\?([^#]+))?(?:#(.+))?/i,l="object",o="string",e=/^\s+|\s+$/g,y,j,n;y=String.prototype.trim?function(H){return(H&&H.trim?H.trim():H);}:function(H){try{return H.replace(e,b);}catch(I){return H;}};j=function(H){return(H&&typeof H===l);};n=function(H){return typeof H===o;};URL.ABSOLUTE=G;URL.RELATIVE=F;URL.normalize=function(H){return new URL(H).toString();};URL.resolve=function(I,H){return new URL(I).resolve(H).toString();};URL.prototype={_init:function(H){this.constructor=URL;H=n(H)?H:H instanceof URL?H.toString():null;this._original=H;this._url={};this._isValid=this._parse(H);return this;},toString:function(){var J=this._url,N=[],K=J[q],H=J[a],M=J[E],L=J[A],I=J[v];if(K===G){N.push(H?(H+h+u):u,this.authority());if(M&&M.indexOf(f)!==0){M=f+M;}}N.push(M,L?(d+this.queryString()):b,I?(i+I):b);return N.join(b);},original:function(){return this._original;},isValid:function(){return this._isValid;},isAbsolute:function(){return this._url[q]===G;},isRelative:function(){return this._url[q]===F;},isHostRelative:function(){var H=this._url[E];return(this.isRelative()&&H&&H.indexOf(f)===0);},type:function(){return this._url[q];},scheme:function(H){return(arguments.length?this._set(a,H):this._url[a]);},userInfo:function(H){return(arguments.length?this._set(s,H):this._url[s]);},host:function(H){return(arguments.length?this._set(D,H):this._url[D]);},domain:function(){var H=this._url[D];return(H?H.split(w).slice(-2).join(w):undefined);},port:function(H){if(arguments.length){return this._set(x,H);}else{return this._url[x];}return(arguments.length?this._set(x,H):this._url[x]);},authority:function(){var J=this._url,H=J[s],K=J[D],I=J[x];return[H?(H+g):b,K,I?(h+I):b,].join(b);},path:function(H){return(arguments.length?this._set(E,H):this._url[E]);},query:function(H){return(arguments.length?this._set(A,H):this._url[A]);},queryString:function(K){if(arguments.length){return this._set(A,this._parseQuery(K));}K=b;var J=this._url[A],I,H;if(J){for(I=0,H=J.length;I<H;I++){K+=J[I].join(p);if(I<H-1){K+=m;}}}return K;},fragment:function(H){return(arguments.length?this._set(v,H):this._url[v]);},resolve:function(I){I=(I instanceof URL)?I:new URL(I);var H,J;if(!(this.isValid()&&I.isValid())){return this;}if(I.isAbsolute()){return(this.isAbsolute()?I.scheme()?I:new URL(I).scheme(this.scheme()):I);}H=new URL(this.isAbsolute()?this:null);if(I.path()){if(I.isHostRelative()||!this.path()){J=I.path();}else{J=this.path().substring(0,this.path().lastIndexOf(f)+1)+I.path();}H.path(this._normalizePath(J)).query(I.query()).fragment(I.fragment());}else{if(I.query()){H.query(I.query()).fragment(I.fragment());}else{if(I.fragment()){H.fragment(I.fragment());}}}return H;},reduce:function(I){I=(I instanceof URL)?I:new URL(I);var H=this.resolve(I);if(this.isAbsolute()&&H.isAbsolute()){if(H.scheme()===this.scheme()&&H.authority()===this.authority()){H.scheme(null).userInfo(null).host(null).port(null);}}return H;},_parse:function(I,J){I=y(I);if(!(n(I)&&I.length>0)){return false;}var K,H;if(!J){J=I.match(z);J=J?J[1]?G:J[2]?F:null:null;}switch(J){case G:K=I.match(t);if(K){H={};H[q]=G;H[a]=K[1]?K[1].toLowerCase():undefined;H[s]=K[2];H[D]=K[3].toLowerCase();H[x]=K[4]?parseInt(K[4],10):undefined;H[E]=K[5]||f;H[A]=this._parseQuery(K[6]);H[v]=K[7];}break;case F:K=I.match(k);if(K){H={};H[q]=F;H[E]=K[1];H[A]=this._parseQuery(K[2]);H[v]=K[3];}break;default:return(this._parse(I,G)||this._parse(I,F));break;}if(H){this._url=H;return true;}else{return false;}},_parseQuery:function(M){if(!n(M)){return;}M=y(M);var K=[],J=M.split(m),L,I,H;for(I=0,H=J.length;I<H;I++){if(J[I]){L=J[I].split(p);K.push(L[1]?L:[L[0]]);}}return K;},_set:function(H,I){this._url[H]=I;if(I&&(H===a||H===s||H===D||H===x)){this._url[q]=G;}if(!I&&H===D){this._url[q]=F;}this._isValid=this._parse(this.toString());return this;},_normalizePath:function(N){var L,K,M,I,J,H;if(N.indexOf(r)>-1){L=N.split(f);M=[];for(J=0,H=L.length;J<H;J++){K=L[J];if(K===B){M.pop();}else{if(K){M.push(K);}}}I=M.join(f);if(N[0]===f){I=f+I;}if(N[N.length-1]===f&&I.length>1){I+=f;}}else{I=N;}return I;}};}());